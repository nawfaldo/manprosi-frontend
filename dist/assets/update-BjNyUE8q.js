import{q as b,u as g,b as j,r as l,j as e,A as p}from"./index-BOs4E3nY.js";import{u as v}from"./useQuery-BLzFuTEq.js";import{u as N}from"./useMutation-CP5VgZfq.js";async function w(s){const n=await fetch(`${p}/sensors/${s}`,{credentials:"include"}),r=await n.json();if(!n.ok||!r.success)throw new Error(r.error||"Failed to fetch sensor");return r.data}async function S(s){const n=await fetch(`${p}/sensors/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:s.name,sensor_type:s.sensor_type})}),r=await n.json();if(!n.ok||!r.success)throw new Error(r.error||"Failed to update sensor");return r.data}function T(){const{sensorId:s,landId:n}=b.useParams(),r=g(),c=j(),[i,u]=l.useState(""),[d,m]=l.useState(""),{data:o,isLoading:x,isError:h,error:y}=v({queryKey:["sensor",s],queryFn:()=>w(s)});l.useEffect(()=>{o&&(u(o.name),m(o.sensor_type))},[o]);const a=N({mutationFn:S,onSuccess:t=>{c.invalidateQueries({queryKey:["land-sensors",t.land_id]}),c.invalidateQueries({queryKey:["sensor",s]}),r({to:`/client/land/${t.land_id}`})}}),f=t=>{t.preventDefault(),!(!i||!d)&&a.mutate({id:s,name:i,sensor_type:d})};return x?e.jsx("p",{className:"p-5",children:"Loading sensor..."}):h?e.jsx("p",{className:"p-5 text-red-500",children:y.message}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsxs("h1",{className:"py-3",children:["Edit Sensor: ",o&&o.name]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"submit",form:"edit-sensor-form",disabled:a.isPending,className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:a.isPending?"Updating...":"Update"}),e.jsx("button",{onClick:()=>r({to:`/client/land/${n}`}),className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"p-5",children:e.jsxs("form",{id:"edit-sensor-form",onSubmit:f,className:"space-y-4 max-w-lg",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sensor Name"}),e.jsx("input",{type:"text",value:i,onChange:t=>u(t.target.value),className:"border border-gray-300 rounded p-2 focus:outline-none focus:border-black"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sensor Type"}),e.jsxs("select",{value:d,onChange:t=>m(t.target.value),className:"border border-gray-300 rounded p-2 focus:outline-none focus:border-black bg-white",children:[e.jsx("option",{value:"Temperature",children:"Temperature"}),e.jsx("option",{value:"Humidity",children:"Humidity"}),e.jsx("option",{value:"SoilMoisture",children:"Soil Moisture"}),e.jsx("option",{value:"PH",children:"pH"}),e.jsx("option",{value:"LightIntensity",children:"Light Intensity"})]})]}),a.isError&&e.jsx("p",{className:"text-red-500 text-sm",children:a.error.message})]})})]})}export{T as component};
