import{o as x,u as h,b as y,j as e,A as i}from"./index-BOs4E3nY.js";import{u as d}from"./useQuery-BLzFuTEq.js";import{u as g}from"./useMutation-CP5VgZfq.js";async function p(a){const t=await fetch(`${i}/automations/${a}`,{credentials:"include"}),s=await t.json();if(!t.ok||!s.success)throw new Error(s.error);return s.data}async function j(a){const t=await fetch(`${i}/automations/${a}`,{method:"DELETE",credentials:"include"}),s=await t.json();if(!t.ok||!s.success)throw new Error(s.error);return s}async function b(a){const t=await fetch(`${i}/automations/${a}/history`,{credentials:"include"}),s=await t.json();if(!t.ok||!s.success)throw new Error(s.error);return s.data}function w(){const{landId:a,automationId:t}=x.useParams(),s=h(),c=y(),{data:r,isLoading:l}=d({queryKey:["automation",t],queryFn:()=>p(t)}),{data:n,isLoading:u}=d({queryKey:["automation-history",t],queryFn:()=>b(t)}),m=g({mutationFn:j,onSuccess:()=>{c.invalidateQueries({queryKey:["land-automations",a]}),s({to:`/client/land/${a}`})}});return l?e.jsx("p",{className:"p-5",children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsxs("h1",{className:"py-3",children:["View Automation: ",r?.name]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>s({to:`/client/land/${a}/automation/${t}/update`}),className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100",children:"Update"}),e.jsx("button",{onClick:()=>{confirm("Delete?")&&m.mutate(Number(r.id))},className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50",children:"Delete"})]})]}),r&&e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3",children:"Configuration"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold text-black",children:"Condition:"})," Trigger when Sensor #",r.sensor_id," > ",r.sensor_value]}),e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold text-black",children:"Action Pump:"})," ",r.pump_id?`Turn On Pump #${r.pump_id}`:"None"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold text-black",children:"Action Valve:"})," ",r.valve_id?`Open Valve #${r.valve_id}`:"None"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3",children:"Execution History"}),u?e.jsx("p",{className:"text-gray-500",children:"Loading history..."}):n&&n.length>0?e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium text-gray-700",children:"Triggered At"}),e.jsx("th",{className:"px-4 py-3 font-medium text-gray-700",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:n.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:o.triggered_at?new Date(o.triggered_at).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 text-xs font-semibold leading-5 text-green-800 bg-green-100 rounded-full",children:"Success"})})]},o.id))})]})}):e.jsx("p",{className:"text-gray-400 italic",children:"No execution history recorded yet."})]})]})]})}export{w as component};
