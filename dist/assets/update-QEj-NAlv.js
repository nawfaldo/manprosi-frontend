import{t as N,u as v,b as w,r as i,j as e,A as f}from"./index-BOs4E3nY.js";import{u as q}from"./useQuery-BLzFuTEq.js";import{u as P}from"./useMutation-CP5VgZfq.js";async function C(t){const r=await fetch(`${f}/plants/${t}`,{credentials:"include"}),a=await r.json();if(!r.ok||!a.success)throw new Error(a.error||"Failed to fetch plant");return a.data}async function E(t){const r=await fetch(`${f}/plants/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:t.name,quantity:t.quantity,planted_at:t.planted_at})}),a=await r.json();if(!r.ok||!a.success)throw new Error(a.error||"Failed to update plant");return a.data}function k(){const{plantId:t,landId:r}=N.useParams(),a=v(),u=w(),[d,m]=i.useState(""),[c,p]=i.useState(""),[l,x]=i.useState(""),{data:s,isLoading:b,isError:y,error:h}=q({queryKey:["plant",t],queryFn:()=>C(t)});i.useEffect(()=>{s&&(m(s.name),p(s.quantity),s.planted_at&&x(s.planted_at.slice(0,16)))},[s]);const o=P({mutationFn:E,onSuccess:n=>{u.invalidateQueries({queryKey:["land-plants",n.land_id]}),u.invalidateQueries({queryKey:["plant",t]}),a({to:`/client/land/${n.land_id}`})}}),g=n=>{if(n.preventDefault(),!d||!c||!l)return;const j=l.length===16?`${l}:00`:l;o.mutate({id:t,name:d,quantity:Number(c),planted_at:j})};return b?e.jsx("p",{className:"p-5",children:"Loading plant..."}):y?e.jsx("p",{className:"p-5 text-red-500",children:h.message}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsxs("h1",{className:"py-3",children:["Edit Plant: ",s&&s.name]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"submit",form:"edit-plant-form",disabled:o.isPending,className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:o.isPending?"Updating...":"Update"}),e.jsx("button",{onClick:()=>a({to:`/client/land/${r}`}),className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"p-5",children:e.jsxs("form",{id:"edit-plant-form",onSubmit:g,className:"space-y-4 max-w-lg",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Plant Name"}),e.jsx("input",{type:"text",value:d,onChange:n=>m(n.target.value),className:"border border-gray-300 rounded p-2 focus:outline-none focus:border-black"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",value:c,onChange:n=>p(n.target.value),className:"border border-gray-300 rounded p-2 focus:outline-none focus:border-black"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Planted At"}),e.jsx("input",{type:"datetime-local",value:l,onChange:n=>x(n.target.value),className:"border border-gray-300 rounded p-2 focus:outline-none focus:border-black bg-white"})]}),o.isError&&e.jsx("p",{className:"text-red-500 text-sm",children:o.error.message})]})})]})}export{k as component};
