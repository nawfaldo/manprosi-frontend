import{u as V,b as Q,a as R,c as M,r as I,j as e,A as l}from"./index-BOs4E3nY.js";import{u as o}from"./useQuery-BLzFuTEq.js";import{u as d}from"./useMutation-CP5VgZfq.js";import{E as h,P as m,T as x}from"./trash-D2V0urTB.js";async function H(s){const t=await fetch(`${l}/lands/${s}`,{credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a.data}async function U(s){const t=await fetch(`${l}/lands/${s}`,{method:"DELETE",credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a}async function B(s){const t=await fetch(`${l}/lands/${s}/sensors`,{credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a.data}async function G(s){const t=await fetch(`${l}/sensors/${s}/latest`,{credentials:"include"});if(t.status===404)return null;const a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a.data}async function J(s){const t=await fetch(`${l}/sensors/${s}`,{method:"DELETE",credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a}async function O(s){const t=await fetch(`${l}/lands/${s}/plants`,{credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a.data}async function W(s){const t=await fetch(`${l}/plants/${s}`,{method:"DELETE",credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a}async function X(s){const t=await fetch(`${l}/lands/${s}/valves`,{credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a.data}async function Y(s){const t=await fetch(`${l}/valves/${s}`,{method:"DELETE",credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a}async function Z(s){const t=await fetch(`${l}/lands/${s}/pumps`,{credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a.data}async function ee(s){const t=await fetch(`${l}/pumps/${s}`,{method:"DELETE",credentials:"include"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error);return a}async function se(s){return(await(await fetch(`${l}/lands/${s}/automations`,{credentials:"include"})).json()).data}async function te(s){return await(await fetch(`${l}/automations/${s}`,{method:"DELETE",credentials:"include"})).json()}function ae({sensor:s,navigate:t,onDelete:a}){const{data:r,isLoading:i}=o({queryKey:["sensor-latest",s.id],queryFn:()=>G(s.id),retry:!1});return e.jsxs("tr",{className:"border-b border-gray-300 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-2.5 text-gray-900 whitespace-nowrap",children:s.name}),e.jsx("td",{className:"p-2.5 text-gray-700 whitespace-nowrap",children:s.sensor_type}),e.jsx("td",{className:"p-2.5 text-gray-700 whitespace-nowrap",children:i?"Loading...":r?`${r.value} ${s.unit}`:e.jsx("span",{className:"text-gray-400 italic",children:"No data"})}),e.jsx("td",{className:"p-2.5 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/sensor/${s.id}`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Detail",children:e.jsx(h,{size:18})}),e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/sensor/${s.id}/update`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Edit",children:e.jsx(m,{size:18})}),e.jsx("button",{className:"p-1 text-red-500 hover:text-red-700",onClick:()=>{confirm(`Delete sensor ${s.name}?`)&&a(s.id)},title:"Delete",children:e.jsx(x,{size:18})})]})}),e.jsx("td",{}),e.jsx("td",{})]})}function ne({plant:s,navigate:t,onDelete:a}){return e.jsxs("tr",{className:"border-b border-gray-300 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-2.5 text-gray-900 whitespace-nowrap",children:s.name}),e.jsx("td",{className:"p-2.5 text-gray-700 whitespace-nowrap",children:s.quantity}),e.jsx("td",{className:"p-2.5 text-gray-700 whitespace-nowrap",children:s.planted_at?new Date(s.planted_at).toLocaleDateString():"-"}),e.jsx("td",{className:"p-2.5 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/plant/${s.id}`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Detail",children:e.jsx(h,{size:18})}),e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/plant/${s.id}/update`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Edit",children:e.jsx(m,{size:18})}),e.jsx("button",{className:"p-1 text-red-500 hover:text-red-700",onClick:()=>{confirm(`Delete plant ${s.name}?`)&&a(s.id)},title:"Delete",children:e.jsx(x,{size:18})})]})}),e.jsx("td",{}),e.jsx("td",{})]})}function re({valve:s,navigate:t,onDelete:a}){return e.jsxs("tr",{className:"border-b border-gray-300 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-2.5 text-gray-900 whitespace-nowrap",children:s.name}),e.jsx("td",{className:"p-2.5 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/valve/${s.id}`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Detail",children:e.jsx(h,{size:18})}),e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/valve/${s.id}/update`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Edit",children:e.jsx(m,{size:18})}),e.jsx("button",{className:"p-1 text-red-500 hover:text-red-700",onClick:()=>{confirm(`Delete valve ${s.name}?`)&&a(s.id)},title:"Delete",children:e.jsx(x,{size:18})})]})}),e.jsx("td",{}),e.jsx("td",{})]})}function le({pump:s,navigate:t,onDelete:a}){return e.jsxs("tr",{className:"border-b border-gray-300 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-2.5 text-gray-900 whitespace-nowrap",children:s.name}),e.jsx("td",{className:"p-2.5 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/pump/${s.id}`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Detail",children:e.jsx(h,{size:18})}),e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/pump/${s.id}/update`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Edit",children:e.jsx(m,{size:18})}),e.jsx("button",{className:"p-1 text-red-500 hover:text-red-700",onClick:()=>{confirm(`Delete pump ${s.name}?`)&&a(s.id)},title:"Delete",children:e.jsx(x,{size:18})})]})}),e.jsx("td",{}),e.jsx("td",{})]})}function ie({auto:s,navigate:t,onDelete:a}){return e.jsxs("tr",{className:"border-b border-gray-300 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-2.5 text-gray-900 whitespace-nowrap",children:s.name}),e.jsxs("td",{className:"p-2.5 text-gray-700 whitespace-nowrap",children:["Sensor ",s.sensor_id," > ",s.sensor_value]}),e.jsxs("td",{className:"p-2.5 text-gray-700 whitespace-nowrap",children:[s.pump_id?`Pump ${s.pump_id} `:"",s.valve_id?`Valve ${s.valve_id}`:""]}),e.jsx("td",{className:"p-2.5 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/automation/${s.id}`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Detail",children:e.jsx(h,{size:18})}),e.jsx("button",{onClick:()=>t({to:`/client/land/${s.land_id}/automation/${s.id}/update`}),className:"p-1 hover:[&_svg]:stroke-[2.5]",title:"Edit",children:e.jsx(m,{size:18})}),e.jsx("button",{className:"p-1 text-red-500 hover:text-red-700",onClick:()=>{confirm("Delete?")&&a(s.id)},title:"Delete",children:e.jsx(x,{size:18})})]})}),e.jsx("td",{}),e.jsx("td",{})]})}function me(){const s=V(),t=Q(),a=R(n=>n.user),{landId:r}=M.useParams(),[i,f]=I.useState("sensors"),b=[{id:"sensors",label:"Sensors"},{id:"plants",label:"Plants"},{id:"valves",label:"Valves"},{id:"pumps",label:"Pumps"},{id:"automations",label:"Automations"}],{data:c,isLoading:w}=o({queryKey:["land",r],queryFn:()=>H(r)}),{data:u,isLoading:v}=o({queryKey:["land-sensors",r],queryFn:()=>B(r)}),{data:p,isLoading:$}=o({queryKey:["land-plants",r],queryFn:()=>O(r)}),{data:j,isLoading:k}=o({queryKey:["land-valves",r],queryFn:()=>X(r)}),{data:N,isLoading:L}=o({queryKey:["land-pumps",r],queryFn:()=>Z(r)}),{data:y,isLoading:E}=o({queryKey:["land-automations",r],queryFn:()=>se(r)}),g=d({mutationFn:U,onSuccess:()=>{t.invalidateQueries({queryKey:["lands",a?.id]}),s({to:"/client"})}}),D=d({mutationFn:J,onSuccess:()=>t.invalidateQueries({queryKey:["land-sensors",r]})}),_=d({mutationFn:W,onSuccess:()=>t.invalidateQueries({queryKey:["land-plants",r]})}),C=d({mutationFn:Y,onSuccess:()=>t.invalidateQueries({queryKey:["land-valves",r]})}),q=d({mutationFn:ee,onSuccess:()=>t.invalidateQueries({queryKey:["land-pumps",r]})}),P=d({mutationFn:te,onSuccess:()=>t.invalidateQueries({queryKey:["land-automations",r]})});if(w)return e.jsx("p",{className:"p-5",children:"Loading land details..."});const S=n=>D.mutate(n),A=n=>_.mutate(n),z=n=>C.mutate(n),T=n=>q.mutate(n),F=n=>P.mutate(n),K=()=>{switch(i){case"sensors":return e.jsxs("div",{className:"mt-5",children:[v&&e.jsx("p",{children:"Loading..."}),u&&u.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left border border-gray-300",children:[e.jsx("th",{className:"p-2.5 font-normal",children:"Name"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Type"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Latest Value"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Actions"}),e.jsx("th",{className:"text-transparent",children:"p"}),e.jsx("th",{className:"text-transparent",children:"p"})]})}),e.jsx("tbody",{children:u.map(n=>e.jsx(ae,{sensor:n,navigate:s,onDelete:S},n.id))})]}):e.jsx("p",{className:"text-gray-500",children:"No sensors installed."})]});case"plants":return e.jsxs("div",{className:"mt-5",children:[$&&e.jsx("p",{children:"Loading..."}),p&&p.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left border border-gray-300",children:[e.jsx("th",{className:"p-2.5 font-normal",children:"Name"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Quantity"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Planted At"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Actions"}),e.jsx("th",{className:"text-transparent",children:"p"}),e.jsx("th",{className:"text-transparent",children:"p"})]})}),e.jsx("tbody",{children:p.map(n=>e.jsx(ne,{plant:n,navigate:s,onDelete:A},n.id))})]}):e.jsx("p",{className:"text-gray-500",children:"No plants recorded."})]});case"valves":return e.jsxs("div",{className:"mt-5",children:[k&&e.jsx("p",{children:"Loading..."}),j&&j.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left border border-gray-300",children:[e.jsx("th",{className:"p-2.5 font-normal",children:"Name"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Actions"}),e.jsx("th",{className:"text-transparent",children:"p"}),e.jsx("th",{className:"text-transparent",children:"p"})]})}),e.jsx("tbody",{children:j.map(n=>e.jsx(re,{valve:n,navigate:s,onDelete:z},n.id))})]}):e.jsx("p",{className:"text-gray-500",children:"No valves installed."})]});case"pumps":return e.jsxs("div",{className:"mt-5",children:[L&&e.jsx("p",{children:"Loading..."}),N&&N.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left border border-gray-300",children:[e.jsx("th",{className:"p-2.5 font-normal",children:"Name"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Actions"}),e.jsx("th",{className:"text-transparent",children:"p"}),e.jsx("th",{className:"text-transparent",children:"p"})]})}),e.jsx("tbody",{children:N.map(n=>e.jsx(le,{pump:n,navigate:s,onDelete:T},n.id))})]}):e.jsx("p",{className:"text-gray-500",children:"No pumps installed."})]});case"automations":return e.jsxs("div",{className:"mt-5",children:[E&&e.jsx("p",{children:"Loading..."}),y&&y.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left border border-gray-300",children:[e.jsx("th",{className:"p-2.5 font-normal",children:"Name"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Trigger"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Action"}),e.jsx("th",{className:"p-2.5 font-normal",children:"Actions"}),e.jsx("th",{className:"text-transparent",children:"p"}),e.jsx("th",{className:"text-transparent",children:"p"})]})}),e.jsx("tbody",{children:y.map(n=>e.jsx(ie,{auto:n,navigate:s,onDelete:F},n.id))})]}):e.jsx("p",{className:"text-gray-500",children:"No automations configured."})]});default:return null}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsxs("h1",{className:"py-3",children:["View Land: ",c&&c.location_name]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>s({to:`/client/land/${r}/update`}),className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50",children:"Update"}),e.jsx("button",{onClick:()=>{c&&confirm(`Delete ${c.location_name}?`)&&g.mutate(Number(c.id))},disabled:g.isPending,className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50 disabled:opacity-50",children:g.isPending?"...":"Delete"})]})]}),c&&e.jsxs("div",{className:"p-5 mb-5",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Location Name:"})," ",c.location_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size:"})," ",c.size," Hectares"]})]}),e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsx("nav",{"aria-label":"Tabs",className:"flex space-x-3",children:b.map(n=>e.jsx("button",{onClick:()=>f(n.id),className:`pb-3 pt-3 px-1 ${i===n.id?"border-b-2 border-black font-medium":"border-b-2 border-transparent text-gray-500"}`,children:n.label},n.id))}),e.jsx("button",{onClick:()=>{i==="sensors"?s({to:`/client/land/${r}/sensor/create`}):i==="plants"?s({to:`/client/land/${r}/plant/create`}):i==="valves"?s({to:`/client/land/${r}/valve/create`}):i==="pumps"?s({to:`/client/land/${r}/pump/create`}):i==="automations"&&s({to:`/client/land/${r}/automation/create`})},className:"px-3 mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100",children:"Create"})]}),e.jsx("div",{className:"px-5",children:K()})]})}export{me as component};
