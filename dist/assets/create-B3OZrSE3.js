import{i as C,u as q,b as $,r as n,j as e,A as o}from"./index-BOs4E3nY.js";import{u as x}from"./useQuery-BLzFuTEq.js";import{u as I}from"./useMutation-CP5VgZfq.js";async function P(s){return(await(await fetch(`${o}/lands/${s}/sensors`,{credentials:"include"})).json()).data}async function V(s){return(await(await fetch(`${o}/lands/${s}/pumps`,{credentials:"include"})).json()).data}async function _(s){return(await(await fetch(`${o}/lands/${s}/valves`,{credentials:"include"})).json()).data}async function A(s){const t=await fetch(`${o}/automations`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)}),r=await t.json();if(!t.ok)throw new Error(r.error);return r.data}function F(){const{landId:s}=C.useParams(),t=q(),r=$(),[l,v]=n.useState(""),[d,b]=n.useState(""),[i,g]=n.useState(""),[c,y]=n.useState(""),[u,j]=n.useState(""),[p,h]=n.useState(""),{data:f}=x({queryKey:["land-sensors",s],queryFn:()=>P(s)}),{data:N}=x({queryKey:["land-pumps",s],queryFn:()=>V(s)}),{data:S}=x({queryKey:["land-valves",s],queryFn:()=>_(s)}),m=I({mutationFn:A,onSuccess:()=>{r.invalidateQueries({queryKey:["land-automations",s]}),t({to:`/client/land/${s}`})},onError:a=>h(a.message)}),w=a=>{if(a.preventDefault(),!l||!d||!i){h("Name, Sensor, and Value required");return}m.mutate({name:l,land_id:Number(s),sensor_id:Number(d),sensor_value:Number(i),pump_id:c?Number(c):null,valve_id:u?Number(u):null})};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsx("h1",{className:"py-3",children:"Add Automation"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"submit",form:"create-auto-form",disabled:m.isPending,className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50",children:m.isPending?"...":"Save"}),e.jsx("button",{onClick:()=>t({to:`/client/land/${s}`}),className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50",children:"Cancel"})]})]}),e.jsx("div",{className:"p-5",children:e.jsxs("form",{id:"create-auto-form",onSubmit:w,className:"space-y-4 max-w-lg",children:[p&&e.jsx("p",{className:"text-red-500 text-sm",children:p}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",value:l,onChange:a=>v(a.target.value),className:"border border-gray-300 rounded p-2",placeholder:"idk"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sensor"}),e.jsxs("select",{value:d,onChange:a=>b(a.target.value),className:"border border-gray-300 rounded p-2 bg-white",children:[e.jsx("option",{value:"",children:"None"}),f?.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.sensor_type,")"]},a.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sensor Value"}),e.jsx("input",{type:"number",step:"0.1",value:i,onChange:a=>g(a.target.value),className:"border border-gray-300 rounded p-2",placeholder:"idk"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Pump"}),e.jsxs("select",{value:c,onChange:a=>y(a.target.value),className:"border border-gray-300 rounded p-2 bg-white",children:[e.jsx("option",{value:"",children:"None"}),N?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Valve"}),e.jsxs("select",{value:u,onChange:a=>j(a.target.value),className:"border border-gray-300 rounded p-2 bg-white",children:[e.jsx("option",{value:"",children:"None"}),S?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})})]})}export{F as component};
