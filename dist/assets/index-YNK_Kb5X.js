import{l as p,u as y,b,j as e,A as d}from"./index-BOs4E3nY.js";import{u as i}from"./useQuery-BLzFuTEq.js";import{u as g}from"./useMutation-CP5VgZfq.js";async function j(t){const s=await fetch(`${d}/sensors/${t}`,{credentials:"include"}),r=await s.json();if(!s.ok||!r.success)throw new Error(r.error||"Failed to fetch sensor");return r.data}async function f(t){const s=await fetch(`${d}/sensors/${t}/latest`,{credentials:"include"});if(s.status===404)return null;const r=await s.json();if(!s.ok||!r.success)throw new Error(r.error||"Failed");return r.data}async function N(t){const s=await fetch(`${d}/sensors/${t}`,{method:"DELETE",credentials:"include"}),r=await s.json();if(!s.ok||!r.success)throw new Error(r.error||"Failed to delete");return r}function E(){const{landId:t,sensorId:s}=p.useParams(),r=y(),l=b(),{data:a,isLoading:c,isError:u,error:m}=i({queryKey:["sensor",s],queryFn:()=>j(s)}),{data:n,isLoading:x}=i({queryKey:["sensor-latest",s],queryFn:()=>f(s),enabled:!!s}),o=g({mutationFn:N,onSuccess:()=>{l.invalidateQueries({queryKey:["land-sensors",t]}),r({to:`/client/land/${t}`})},onError:h=>{alert(h.message)}});return c?e.jsx("p",{className:"p-5",children:"Loading sensor details..."}):u?e.jsx("p",{className:"p-5 text-red-500",children:m.message}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsxs("h1",{className:"py-3",children:["View Sensor: ",a&&a.name]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>r({to:`/client/land/${t}/sensor/update/${s}`}),className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"Update"}),e.jsx("button",{onClick:()=>{a&&confirm(`Delete sensor ${a.name}?`)&&o.mutate(Number(a.id))},disabled:o.isPending,className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50 transition-colors disabled:opacity-50",children:o.isPending?"...":"Delete"})]})]}),a&&e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"mb-8",children:[" ",e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3",children:"Sensor Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold text-black",children:"Name:"})," ",a.name]}),e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold text-black",children:"Type:"})," ",a.sensor_type]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Latest Reading"}),x?e.jsx("p",{className:"text-gray-500",children:"Loading latest value..."}):n?e.jsxs("div",{children:[e.jsx("div",{className:"text-4xl font-bold text-gray-900",children:n.value}),e.jsxs("p",{className:"text-xs font-bold text-gray-400 mt-2",children:["Recorded at: ",n.recorded_at?new Date(n.recorded_at).toLocaleString():"Invalid Date"]})]}):e.jsx("p",{className:"text-gray-400 italic",children:"No data recorded yet."})]})]})]})}export{E as component};
