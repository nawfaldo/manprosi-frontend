import{u as g,b as f,a as c,j as r,A as a}from"./index-BOs4E3nY.js";import{u as y}from"./useQuery-BLzFuTEq.js";import{u as d}from"./useMutation-CP5VgZfq.js";async function j(){const e=await fetch(`${a}/logout`,{method:"POST",credentials:"include"});if(!e.ok)throw new Error("Logout failed");return e.json()}async function w(){const e=await fetch(`${a}/users`,{credentials:"include"}),t=await e.json();if(!e.ok||!t.success)throw new Error(t.error||"Failed to fetch users");return t.data}async function x(e){const t=await fetch(`${a}/users/${e}`,{method:"DELETE",credentials:"include"}),n=await t.json();if(!t.ok||!n.success)throw new Error(n.error||"Failed to delete user");return n}function p(e){switch(e){case 1:return"Admin";case 2:return"Farmer";case 3:return"Consultant";default:return"Unknown"}}function C(){const e=g(),t=f(),n=c(s=>s.user),o=d({mutationFn:j,onSuccess:async()=>{await c.getState().clearUser(),await t.removeQueries({queryKey:["auth"]}),e({to:"/login"})}}),{data:u,isLoading:l,isError:m,error:h}=y({queryKey:["users"],queryFn:w}),i=d({mutationFn:x,onSuccess:()=>{t.invalidateQueries({queryKey:["users"]})},onError:s=>{alert(s.message)}});return r.jsxs("div",{children:[r.jsxs("p",{children:["hi ",n?.role," ",n?.username]}),r.jsx("button",{onClick:()=>o.mutate(),disabled:o.isPending,children:o.isPending?"Logging out...":"Logout"}),o.isError&&r.jsx("p",{style:{color:"red"},children:o.error.message}),r.jsx("h2",{children:"User List"}),l&&r.jsx("p",{children:"Loading users..."}),m&&r.jsx("p",{style:{color:"red"},children:h.message}),u&&r.jsx("ul",{children:u.map(s=>r.jsxs("li",{children:[s.username," (",p(s.user_role_id),")"," ",r.jsx("button",{onClick:()=>e({to:`/admin/update-user/${s.id}`}),children:"Edit"})," ",r.jsx("button",{onClick:()=>{confirm(`Are you sure you want to delete ${s.username}?`)&&i.mutate(s.id)},disabled:i.isPending,children:i.isPending?"Deleting...":"Delete"})]},s.id))})]})}export{C as component};
