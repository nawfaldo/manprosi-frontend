import{v as q,u as $,b as C,r,j as e,A as o}from"./index-BOs4E3nY.js";import{u as d}from"./useQuery-BLzFuTEq.js";import{u as I}from"./useMutation-CP5VgZfq.js";async function _(t){return(await(await fetch(`${o}/automations/${t}`,{credentials:"include"})).json()).data}async function P(t){return(await(await fetch(`${o}/lands/${t}/sensors`,{credentials:"include"})).json()).data}async function F(t){return(await(await fetch(`${o}/lands/${t}/pumps`,{credentials:"include"})).json()).data}async function K(t){return(await(await fetch(`${o}/lands/${t}/valves`,{credentials:"include"})).json()).data}async function V(t){const s=await fetch(`${o}/automations/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed");return(await s.json()).data}function L(){const{automationId:t,landId:s}=q.useParams(),c=$(),m=C(),[x,p]=r.useState(""),[h,v]=r.useState(""),[y,g]=r.useState(""),[l,b]=r.useState(""),[i,f]=r.useState(""),{data:n}=d({queryKey:["automation",t],queryFn:()=>_(t)}),{data:j}=d({queryKey:["land-sensors",s],queryFn:()=>P(s)}),{data:N}=d({queryKey:["land-pumps",s],queryFn:()=>F(s)}),{data:w}=d({queryKey:["land-valves",s],queryFn:()=>K(s)});r.useEffect(()=>{n&&(p(n.name),v(n.sensor_id),g(n.sensor_value),b(n.pump_id||""),f(n.valve_id||""))},[n]);const u=I({mutationFn:V,onSuccess:()=>{m.invalidateQueries({queryKey:["land-automations",s]}),m.invalidateQueries({queryKey:["automation",t]}),c({to:`/client/land/${s}`})}}),S=a=>{a.preventDefault(),u.mutate({id:t,name:x,sensor_id:Number(h),sensor_value:Number(y),pump_id:l?Number(l):null,valve_id:i?Number(i):null})};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between px-5 border-b border-gray-300",children:[e.jsx("h1",{className:"py-3",children:"Edit Automation"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"submit",form:"edit-auto-form",disabled:u.isPending,className:"w-[80px] mt-1 h-[40px] border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50",children:u.isPending?"...":"Update"}),e.jsx("button",{onClick:()=>c({to:`/client/land/${s}`}),className:"w-[80px] mt-1 h-[40px] border border-red-200 text-red-600 rounded hover:bg-red-50",children:"Cancel"})]})]}),e.jsx("div",{className:"p-5",children:e.jsxs("form",{id:"edit-auto-form",onSubmit:S,className:"space-y-4 max-w-lg",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",value:x,onChange:a=>p(a.target.value),className:"border border-gray-300 rounded p-2"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sensor"}),e.jsxs("select",{value:h,onChange:a=>v(a.target.value),className:"border border-gray-300 rounded p-2 bg-white",children:[e.jsx("option",{value:"",children:"Select Sensor"}),j?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sensor Value"}),e.jsx("input",{type:"number",step:"0.1",value:y,onChange:a=>g(a.target.value),className:"border border-gray-300 rounded p-2"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Pump"}),e.jsxs("select",{value:l,onChange:a=>b(a.target.value),className:"border border-gray-300 rounded p-2 bg-white",children:[e.jsx("option",{value:"",children:"None"}),N?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Valve"}),e.jsxs("select",{value:i,onChange:a=>f(a.target.value),className:"border border-gray-300 rounded p-2 bg-white",children:[e.jsx("option",{value:"",children:"None"}),w?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})})]})}export{L as component};
